<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Portfolio of Md Raihain Kawshaik</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
<style>
  :root {
    --primary: #6366f1;
    --primary-dark: #4f46e5;
    --success: #10b981;
    --danger: #ef4444;
    --bg-gradient: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    --card-bg: rgba(30, 41, 59, 0.45);
    --card-border: rgba(255,255,255,0.08);
    --text: #f1f5f9;
    --text-muted: #94a3b8;
  }

  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    font-family: 'Inter', system-ui, sans-serif;
    background: var(--bg-gradient);
    color: var(--text);
    min-height: 100vh;
    padding: 30px 20px;
    background-attachment: fixed;
  }

  .container { max-width: 1500px; margin: 0 auto; }

  h1 {
    text-align: center;
    font-size: 2.6rem;
    font-weight: 700;
    margin-bottom: 8px;
    background: linear-gradient(90deg, #a5b4fc, #c084fc);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .subtitle { text-align:center; color:var(--text-muted); margin-bottom:40px; font-size:1.1rem; }

  .dashboard {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 24px;
    margin-bottom: 40px;
  }

  .card {
    background: var(--card-bg);
    backdrop-filter: blur(12px);
    border: 1px solid var(--card-border);
    border-radius: 16px;
    padding: 24px;
    transition: all 0.3s ease;
    box-shadow: 0 10px 30px rgba(0,0,0,0.4);
  }

  .card:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 40px rgba(0,0,0,0.5);
  }

  .card-title {
    color: var(--text-muted);
    font-size: 0.9rem;
    margin-bottom: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .card-value {
    font-size: 2.1rem;
    font-weight: 700;
  }

  .positive { color: var(--success); }
  .negative { color: var(--danger); }

  .section {
    background: var(--card-bg);
    backdrop-filter: blur(12px);
    border: 1px solid var(--card-border);
    border-radius: 16px;
    padding: 28px;
    margin-bottom: 40px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.4);
  }

  .form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 24px;
  }

  label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: #cbd5e1;
  }

  input, select {
    width: 100%;
    padding: 12px 16px;
    border: 1px solid #475569;
    border-radius: 10px;
    background: rgba(255,255,255,0.05);
    color: var(--text);
    font-size: 1rem;
  }

  select {
    appearance: none;
    background: rgba(255,255,255,0.05) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23cbd5e1' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E") no-repeat right 1rem center/12px;
  }

  input:focus, select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(99,102,241,0.25);
  }

  .btn {
    padding: 12px 24px;
    border: none;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.25s ease;
  }

  .btn-primary { background: var(--primary); color: white; }
  .btn-primary:hover { background: var(--primary-dark); transform: translateY(-2px); }

  .btn-success { background: var(--success); color: white; }
  .btn-danger  { background: var(--danger);  color: white; }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    font-size: 0.95rem;
  }

  th, td { padding: 14px 12px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.08); }
  th { background: rgba(255,255,255,0.05); color: #cbd5e1; font-weight: 600; }

  /* Improved symbol visibility */
  td:nth-child(2) {  /* Symbol column */
    background: #1e293b;
    font-weight: 600;
    color: #e0f2fe;
    border-radius: 6px;
  }

  tr:hover { background: rgba(255,255,255,0.03); }

  .profit { color: var(--success); font-weight: 600; }
  .loss   { color: var(--danger);  font-weight: 600; }

  .action-btn { background:none; border:none; color:#f87171; cursor:pointer; font-size:1.2rem; }

  .controls { display: flex; gap: 16px; flex-wrap: wrap; margin-bottom: 24px; }

  @media (max-width: 768px) {
    .dashboard, .form-grid { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

<div class="container">
  <h1><i class="fas fa-chart-line"></i> Portfolio of Md Raihain Kawshaik</h1>
  <p class="subtitle">Personal DSE Trading Journal • Updated January 2026</p>

  <!-- Dashboard -->
  <div class="dashboard">
    <div class="card"><div class="card-title">Realized P/L</div><div class="card-value" id="realizedPL">0.00 BDT</div></div>
    <div class="card"><div class="card-title">Unrealized P/L</div><div class="card-value" id="unrealizedPL">0.00 BDT</div></div>
    <div class="card"><div class="card-title">Total Commission</div><div class="card-value" id="totalComm">-0.00 BDT</div></div>
    <div class="card"><div class="card-title">Net P/L (Realized - Comm)</div><div class="card-value" id="netPL">0.00 BDT</div></div>
    <div class="card"><div class="card-title">Portfolio Value</div><div class="card-value" id="portfolioValue">0.00 BDT</div></div>
    <div class="card"><div class="card-title">Total Invested</div><div class="card-value" id="totalInvested">0.00 BDT</div></div>
    <div class="card"><div class="card-title">Overall Return</div><div class="card-value" id="overallReturn">0.00%</div></div>
  </div>

  <!-- Controls & Add Trade -->
  <div class="section">
    <div class="controls">
      <button class="btn btn-primary" onclick="addTrade()"><i class="fas fa-plus"></i> Add Trade</button>
      <button class="btn btn-success" onclick="updateAllCurrentPrices()"><i class="fas fa-sync"></i> Update Prices</button>
      <button class="btn btn-success" onclick="exportData()"><i class="fas fa-download"></i> Export JSON</button>
      <input type="file" id="importFile" accept=".json" style="display:none;" onchange="importData(event)">
      <button class="btn btn-primary" onclick="document.getElementById('importFile').click()"><i class="fas fa-upload"></i> Import JSON</button>
      <button class="btn btn-danger" onclick="clearAllData()"><i class="fas fa-trash-alt"></i> Clear All</button>
    </div>

    <h2><i class="fas fa-plus-circle"></i> Add New Trade</h2>
    <div class="form-grid">
      <div>
        <label>Symbol</label>
        <select id="symbol" required>
          <option value="">Select Share...</option>
        </select>
      </div>
      <div><label>Date</label><input type="date" id="date" required></div>
      <div><label>Type</label><select id="type"><option value="BUY">BUY</option><option value="SELL">SELL</option></select></div>
      <div><label>Quantity</label><input type="number" id="qty" min="1" required></div>
      <div><label>Price (৳)</label><input type="number" id="price" step="0.01" required></div>
      <div><label>Current Price (৳)</label><input type="number" id="currentPrice" step="0.01" placeholder="optional" value=""></div>
    </div>
  </div>

  <!-- Trade History -->
  <div class="section">
    <h2><i class="fas fa-history"></i> Trade History</h2>
    <table id="tradeTable">
      <thead>
        <tr>
          <th>Date</th><th>Symbol</th><th>Type</th><th>Qty</th><th>Price</th><th>Commission</th>
          <th>Total Cost</th><th>Avg Cost</th><th>Current</th><th>Realized P/L</th><th>Unrealized P/L</th><th></th>
        </tr>
      </thead>
      <tbody id="tradeBody"></tbody>
    </table>

    <h2 style="margin:40px 0 20px;"><i class="fas fa-wallet"></i> Current Holdings</h2>
    <table id="holdingsTable">
      <thead>
        <tr><th>Symbol</th><th>Quantity</th><th>Avg Cost</th><th>Current Price</th><th>Unrealized P/L</th></tr>
      </thead>
      <tbody id="holdingsBody"></tbody>
    </table>
  </div>
</div>

<script>
// ──────────────────────────────────────────────────────────────
// SETTINGS & DATA
// ──────────────────────────────────────────────────────────────
const COMMISSION_RATE = 0.0040;
const DELETE_PASSWORD = "12345";

const DSE_SYMBOLS = [
  "1JANATAMF","1STPRIMFMF","AAMRANET","AAMRATECH","ABB1STMF","ABBANK","ACFL","ACI","ACIFORMULA","ACMELAB","ACMEPL","ACTIVEFINE","ADNTEL","ADVENT","AFCAGRO","AFTABAUTO","AGNISYSL","AGRANINS","AIBL1STIMF","AIL","AL-HAJTEX","ALARABANK","ALIF","ALLTEX","AMANFEED","AMBEEPHA","AMCL(PRAN)","ANLIMAYARN","ANWARGALV","AOL","APEXFOODS","APEXFOOT","APEXSPINN","APEXTANRY","APOLOISPAT","ARAMIT","ARAMITCEM","ARGONDENIM","ASIAINS","ASIAPACINS","ASIATICLAB","ATLASBANG","AZIZPIPES","BANGAS","BANKASIA","BARKAPOWER","BATASHOE","BATBC","BAYLEASING","BBS","BBSCABLES","BDAUTOCA","BDCOM","BDFINANCE","BDLAMPS","BDTHAI","BDTHAIFOOD","BDWELDING","BEACHHATCH","BEACONPHAR","BENGALWTL","BERGERPBL","BESTHLDNG","BEXGSUKUK","BEXIMCO","BGIC","BIFC","BNICL","BPML","BPPL","BRACBANK","BSC","BSCPLC","BSRMLTD","BSRMSTEEL","BXPHARMA","CAPITECGBF","CAPMBDBLMF","CAPMIBBLMF","CENTRALINS","CENTRALPHL","CITYBANK","CITYGENINS","CLICL","CNATEX","CONFIDCEM","CONTININS","COPPERTECH","CROWNCEMNT","CRYSTALINS","CVOPRL","DACCADYE","DAFODILCOM","DBH","DBH1STMF","DELTALIFE","DELTASPINN","DESCO","DESHBANDHU","DGIC","DHAKABANK","DHAKAINS","DOMINAGE","DOREENPWR","DSHGARME","DSSL","DULAMIACOT","DUTCHBANGL","EASTERNINS","EASTLAND","EASTRNLUB","EBL","EBL1STMF","EBLNRBMF","ECABLES","EGEN","EHL","EIL","EMERALDOIL","ENVOYTEX","EPGL","ESQUIRENIT","ETL","EXIM1STMF","FAMILYTEX","FARCHEM","FAREASTFIN","FAREASTLIF","FASFIN","FBFIF","FEDERALINS","FEKDIL","FINEFOODS","FIRSTFIN","FORTUNE","FUWANGCER","FUWANGFOOD","GBBPOWER","GEMINISEA","GENEXIL","GENNEXT","GHAIL","GHCL","GLDNJMF","GLOBALINS","GOLDENSON","GP","GPHISPAT","GQBALLPEN","GRAMEENS2","GREENDELMF","GREENDELT","GSPFINANCE","HAKKANIPUL","HAMI","HEIDELBCEM","HFL","HRTEX","HWAWELLTEX","IBBLPBOND","IBNSINA","IBP","ICB","ICB3RDNRB","ICBAGRANI1","ICBAMCL2ND","ICBEPMF1S1","ICBIBANK","ICBSONALI1","ICICL","IDLC","IFADAUTOS","IFIC","IFIC1STMF","IFILISLMF1","ILFSL","INDEXAGRO","INTECH","INTRACO","IPDC","ISLAMIBANK","ISLAMICFIN","ISLAMIINS","ISNLTD","ITC","JAMUNABANK","JAMUNAOIL","JANATAINS","JHRML","JMISMDL","JUTESPINN","KARNAPHULI","KAY&QUE","KBPPWBIL","KDSALTD","KEYACOSMET","KOHINOOR","KPCL","KPPL","KTL","LANKABAFIN","LEGACYFOOT","LHB","LIBRAINFU","LINDEBD","LOVELLO","LRBDL","LRGLOBMF1","MAGURAPLEX","MAKSONSPIN","MALEKSPIN","MARICO","MATINSPINN","MBL1STMF","MEGCONMILK","MEGHNACEM","MEGHNAINS","MEGHNALIFE","MEGHNAPET","MERCANBANK","MERCINS","METROSPIN","MHSML","MIDASFIN","MIDLANDBNK","MIRACLEIND","MIRAKHTER","MITHUNKNIT","MJLBD","MLDYEING","MONNOAGML","MONNOCERA","MONNOFABR","MONOSPOOL","MPETROLEUM","MTB","NAHEEACP","NATLIFEINS","NAVANACNG","NAVANAPHAR","NBL","NCCBANK","NCCBLMF1","NEWLINE","NFML","NHFIL","NITOLINS","NORTHERN","NORTHRNINS","NPOLYMER","NRBBANK","NRBCBANK","NTC","NTLTUBES","NURANI","OAL","OIMEX","OLYMPIC","ONEBANKPLC","ORIONINFU","ORIONPHARM","PADMALIFE","PADMAOIL","PARAMOUNT","PDL","PENINSULA","PEOPLESINS","PF1STMF","PHARMAID","PHENIXINS","PHOENIXFIN","PHPMF1","PIONEERINS","PLFSL","POPULAR1MF","POPULARLIF","POWERGRID","PRAGATIINS","PRAGATILIF","PREMIERBAN","PREMIERCEM","PREMIERLEA","PRIME1ICBA","PRIMEBANK","PRIMEFIN","PRIMEINSUR","PRIMELIFE","PRIMETEX","PROGRESLIF","PROVATIINS","PTL","PUBALIBANK","PURABIGEN","QUASEMIND","QUEENSOUTH","RAHIMAFOOD","RAHIMTEXT","RAKCERAMIC","RANFOUNDRY","RDFOOD","RECKITTBEN","REGENTTEX","RELIANCE1","RELIANCINS","RENATA","RENWICKJA","REPUBLIC","RINGSHINE","ROBI","RSRMSTEEL","RUNNERAUTO","RUPALIBANK","RUPALIINS","RUPALILIFE","SAFKOSPINN","SAIFPOWER","SAIHAMCOT","SAIHAMTEX","SALAMCRST","SALVO","SAMATALETH","SAMORITA","SANDHANINS","SAPORTL","SBACBANK","SEAPEARL","SEMLFBSLGF","SEMLIBBLSF","SHAHJABANK","SHARPIND","SHASHADNIM","SHEPHERD","SHURWID","SHYAMPSUG","SICL","SILCOPHL","SILVAPHL","SIMTEX","SINGERBD","SINOBANGLA","SIPLC","SKTRIMS","SONALIANSH","SONALILIFE","SONALIPAPR","SONARBAINS","SONARGAON","SOUTHEASTB","SPCERAMICS","SPCL","SQUARETEXT","SQURPHARMA","SSSTEEL","STANCERAM","STANDARINS","STANDBANKL","STYLECRAFT","SUMITPOWER","SUNLIFEINS","TAKAFULINS","TALLUSPIN","TAMIJTEX","TECHNODRUG","TILIL","TITASGAS","TOSRIFA","TRUSTB1MF","TRUSTBANK","TUNGHAI","UCB","UNILEVERCL","UNIONCAP","UNIONINS","UNIQUEHRL","UNITEDFIN","UNITEDINS","UPGDCL","USMANIAGL","UTTARABANK","UTTARAFIN","VAMLRBBF","VFSTDL","WALTONHIL","WATACHEM","WMSHIPYARD","YPL","ZAHEENSPIN","ZAHINTEX","ZEALBANGLA"
];

let trades = JSON.parse(localStorage.getItem('dse_trades')) || [];
let currentPrices = JSON.parse(localStorage.getItem('dse_current_prices')) || {};

// ──────────────────────────────────────────────────────────────
// CORE FUNCTIONS
// ──────────────────────────────────────────────────────────────
function init() {
  const select = document.getElementById('symbol');
  DSE_SYMBOLS.sort().forEach(sym => {
    const option = document.createElement('option');
    option.value = sym;
    option.textContent = sym;
    select.appendChild(option);
  });
  refreshAll();
}

function saveData() {
  localStorage.setItem('dse_trades', JSON.stringify(trades));
  localStorage.setItem('dse_current_prices', JSON.stringify(currentPrices));
  refreshAll();
}

function refreshAll() {
  updateDashboard();
  renderTable();
  renderHoldings();
}

// ──────────────────────────────────────────────────────────────
// ADD / UPDATE / DELETE
// ──────────────────────────────────────────────────────────────
function addTrade() {
  const symbol = document.getElementById('symbol').value;
  if (!symbol) return alert("Please select a symbol!");

  const qty = Number(document.getElementById('qty').value);
  const price = Number(document.getElementById('price').value);
  if (!qty || !price) return alert("Please fill quantity and price!");

  const trade = {
    id: Date.now(),
    date: document.getElementById('date').value,
    symbol,
    type: document.getElementById('type').value,
    qty,
    price,
    currentPrice: Number(document.getElementById('currentPrice').value || 0)
  };

  if (trade.type === 'SELL') {
    const holding = getHolding(symbol);
    if (holding.qty < qty) return alert(`Not enough shares! You have only ${holding.qty}`);
  }

  if (trade.currentPrice > 0) currentPrices[symbol] = trade.currentPrice;

  trades.push(trade);
  saveData();

  document.getElementById('qty').value = '';
  document.getElementById('price').value = '';
  document.getElementById('currentPrice').value = '';
}

function deleteTrade(id) {
  const pw = prompt("Enter password to delete:");
  if (pw !== DELETE_PASSWORD) return alert("Incorrect password!");
  if (confirm("Delete this trade?")) {
    trades = trades.filter(t => t.id !== id);
    saveData();
  }
}

function clearAllData() {
  const pw = prompt("Enter password to clear ALL data:");
  if (pw !== DELETE_PASSWORD) return alert("Incorrect password!");
  if (confirm("Delete ALL data permanently?")) {
    trades = [];
    currentPrices = {};
    localStorage.clear();
    refreshAll();
  }
}

function updateAllCurrentPrices() {
  if (trades.length === 0) return alert("No trades yet!");
  const unique = [...new Set(trades.map(t => t.symbol))].sort();
  unique.forEach(sym => {
    const curr = currentPrices[sym] || '';
    const input = prompt(`Current price for ${sym} (৳)? (empty/cancel = skip)`, curr);
    if (input !== null && input.trim() !== '') {
      const p = Number(input);
      if (!isNaN(p) && p > 0) currentPrices[sym] = p;
    }
  });
  trades.forEach(t => {
    if (t.type === 'BUY' && currentPrices[t.symbol]) t.currentPrice = currentPrices[t.symbol];
  });
  saveData();
  alert("Prices updated!");
}

// Export / Import functions (same as before)
function exportData() {
  const data = { trades, currentPrices, exported: new Date().toISOString() };
  const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `portfolio-md-raihain-${new Date().toISOString().split('T')[0]}.json`;
  a.click();
  URL.revokeObjectURL(url);
}

function importData(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    try {
      const data = JSON.parse(e.target.result);
      if (data.trades && data.currentPrices) {
        trades = data.trades;
        currentPrices = data.currentPrices;
        saveData();
        alert("Data imported successfully!");
      } else alert("Invalid file format!");
    } catch(err) { alert("Error: " + err.message); }
  };
  reader.readAsText(file);
}

// ──────────────────────────────────────────────────────────────
// CALCULATIONS
// ──────────────────────────────────────────────────────────────
function getHolding(symbol) {
  let qty = 0, totalCost = 0;
  trades.filter(t => t.symbol === symbol)
        .sort((a,b) => new Date(a.date) - new Date(b.date))
        .forEach(t => {
          const value = t.qty * t.price;
          const comm = value * COMMISSION_RATE;
          if (t.type === 'BUY') {
            qty += t.qty;
            totalCost += value + comm;
          } else {
            const avg = qty > 0 ? totalCost / qty : 0;
            qty -= t.qty;
            totalCost -= t.qty * avg;
          }
        });
  return { qty: Math.max(0, qty), avgCost: qty > 0 ? totalCost / qty : 0 };
}

function calculate() {
  let realized = 0, unrealized = 0, commissionTotal = 0, portfolioValue = 0, totalInvested = 0;

  const holdings = {};

  trades.forEach(t => {
    const value = t.qty * t.price;
    const comm = value * COMMISSION_RATE;
    commissionTotal += comm;

    if (t.type === 'BUY') totalInvested += value + comm;

    if (!holdings[t.symbol]) holdings[t.symbol] = {qty:0, totalCost:0};
    if (t.type === 'BUY') {
      holdings[t.symbol].qty += t.qty;
      holdings[t.symbol].totalCost += value + comm;
    } else {
      const avg = holdings[t.symbol].qty > 0 ? holdings[t.symbol].totalCost / holdings[t.symbol].qty : 0;
      realized += (t.qty * t.price) - (t.qty * avg);
      holdings[t.symbol].qty -= t.qty;
      holdings[t.symbol].totalCost -= t.qty * avg;
    }
  });

  for (const sym in holdings) {
    const pos = holdings[sym];
    if (pos.qty > 0) {
      const avg = pos.totalCost / pos.qty;
      const curr = currentPrices[sym] || 0;
      if (curr > 0) {
        unrealized += pos.qty * (curr - avg);
        portfolioValue += pos.qty * curr;
      }
    }
  }

  const net = realized - commissionTotal;  // ← Changed: only realized - commission

  const returnPercent = totalInvested > 0 ? (net / totalInvested) * 100 : 0;

  return { realized, unrealized, commission: commissionTotal, net, portfolioValue, totalInvested, returnPercent };
}

function updateDashboard() {
  const s = calculate();
  const fmt = n => n.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  const pct = n => n.toFixed(2) + "%";

  document.getElementById('realizedPL').textContent = fmt(s.realized) + " BDT";
  document.getElementById('realizedPL').className = 'card-value ' + (s.realized >= 0 ? 'positive' : 'negative');

  document.getElementById('unrealizedPL').textContent = fmt(s.unrealized) + " BDT";
  document.getElementById('unrealizedPL').className = 'card-value ' + (s.unrealized >= 0 ? 'positive' : 'negative');

  document.getElementById('totalComm').textContent = "-" + fmt(s.commission) + " BDT";

  document.getElementById('netPL').textContent = fmt(s.net) + " BDT";
  document.getElementById('netPL').className = 'card-value ' + (s.net >= 0 ? 'positive' : 'negative');

  document.getElementById('portfolioValue').textContent = fmt(s.portfolioValue) + " BDT";

  document.getElementById('totalInvested').textContent = fmt(s.totalInvested) + " BDT";
  document.getElementById('overallReturn').textContent = pct(s.returnPercent);
  document.getElementById('overallReturn').className = 'card-value ' + (s.returnPercent >= 0 ? 'positive' : 'negative');
}

// ──────────────────────────────────────────────────────────────
// RENDERING FUNCTIONS (table & holdings)
// ──────────────────────────────────────────────────────────────
function renderTable() {
  const tbody = document.getElementById('tradeBody');
  tbody.innerHTML = '';
  const temp = {};

  trades.sort((a,b) => new Date(a.date) - new Date(b.date)).forEach(t => {
    const value = t.qty * t.price;
    const comm = value * COMMISSION_RATE;
    const totalCost = value + comm;

    let realizedPL = '-', unrealizedPL = '-', avgCost = '-', totalCostDisp = '-';

    if (!temp[t.symbol]) temp[t.symbol] = {qty:0, totalCost:0};

    if (t.type === 'BUY') {
      temp[t.symbol].qty += t.qty;
      temp[t.symbol].totalCost += totalCost;
      avgCost = (temp[t.symbol].totalCost / temp[t.symbol].qty).toFixed(2);
      totalCostDisp = totalCost.toFixed(2);
      if (currentPrices[t.symbol]) unrealizedPL = (temp[t.symbol].qty * (currentPrices[t.symbol] - avgCost)).toFixed(2);
    } else {
      const avg = temp[t.symbol].qty > 0 ? temp[t.symbol].totalCost / temp[t.symbol].qty : 0;
      realizedPL = ((t.qty * t.price) - (t.qty * avg)).toFixed(2);
      temp[t.symbol].qty -= t.qty;
      temp[t.symbol].totalCost -= t.qty * avg;
    }

    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${t.date || '-'}</td>
      <td><b>${t.symbol}</b></td>
      <td><span style="color:${t.type==='BUY'?'#6366f1':'#ef4444'}"><b>${t.type}</b></span></td>
      <td>${t.qty.toLocaleString()}</td>
      <td>${t.price.toFixed(2)}</td>
      <td>${comm.toFixed(2)}</td>
      <td>${totalCostDisp}</td>
      <td>${avgCost}</td>
      <td>${currentPrices[t.symbol]?.toFixed(2) || '-'}</td>
      <td class="${realizedPL === '-' ? '' : (Number(realizedPL) >= 0 ? 'profit' : 'loss')}">${realizedPL}</td>
      <td class="${unrealizedPL === '-' ? '' : (Number(unrealizedPL) >= 0 ? 'profit' : 'loss')}">${unrealizedPL}</td>
      <td><button class="action-btn" onclick="deleteTrade(${t.id})"><i class="fas fa-trash"></i></button></td>
    `;
    tbody.appendChild(row);
  });
}

function renderHoldings() {
  const tbody = document.getElementById('holdingsBody');
  tbody.innerHTML = '';
  const symbols = [...new Set(trades.map(t => t.symbol))];
  symbols.forEach(sym => {
    const h = getHolding(sym);
    if (h.qty <= 0) return;
    const curr = currentPrices[sym] || 0;
    const unreal = curr > 0 ? (h.qty * (curr - h.avgCost)).toFixed(2) : '-';
    const row = document.createElement('tr');
    row.innerHTML = `
      <td><b>${sym}</b></td>
      <td>${h.qty.toLocaleString()}</td>
      <td>${h.avgCost.toFixed(2)}</td>
      <td>${curr ? curr.toFixed(2) : '-'}</td>
      <td class="${unreal === '-' ? '' : (Number(unreal) >= 0 ? 'profit' : 'loss')}">${unreal}</td>
    `;
    tbody.appendChild(row);
  });
}

// Start application
init();
</script>
</body>
</html>